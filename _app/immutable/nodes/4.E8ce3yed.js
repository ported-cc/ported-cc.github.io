import"../chunks/DsnmJJEf.js";import{o as ae,h as re,d as oe,s as T}from"../chunks/9iyfFM9-.js";import{p as se,K as ne,P as e,f as p,T as S,a as f,b as ie,Z as k,a2 as le,X as w,t as C,Y as g,$ as ce,V as b,W as y,a3 as z,n as de}from"../chunks/BqoRkx5S.js";import{i as P}from"../chunks/D2ds56Re.js";import{s as N}from"../chunks/-ua00iTI.js";import{b as me}from"../chunks/C9hx2HfJ.js";import{C as ue,c as ge,g as fe,a as pe,s as ve,d as he,S as u,w as H,b as I,i as j,t as _e,e as ke,f as we}from"../chunks/Bz4er2_g.js";import{u as Ie}from"../chunks/DxAMoxK6.js";import{p as D}from"../chunks/hzVR3tAY.js";class be extends ue.classBuilder().ep({...ge,ResourceArn:{type:"contextParams",name:"TableName"}}).m(function(v,s,c,h){return[fe(c,this.serialize,this.deserialize),pe(c,v.getEndpointParameterInstructions())]}).s("DynamoDB_20120810","GetItem",{}).n("DynamoDBClient","GetItemCommand").f(void 0,void 0).ser(ve).de(he).build(){}function ye(A,v){if(console.log("[R][PLAY][play] Play button clicked"),console.log("[R][PLAY][play] Dev mode:",localStorage.getItem("devMode")),localStorage.getItem("devMode")=="true"){const s={apiKey:"193de488-c5ba-461a-8ccf-8309cbc721a2",injectionElementId:"ad-container",adStatusCallbackFn:c=>{console.log("OUTSIDE Ad status: ",c),["allAdsCompleted","click","complete","skipped","manuallyEnded","thankYouModalClosed"].includes(c)&&g(v,!0),c==="consentDeclined"&&(alert("Please consent to ads to play the game."),location.reload())},adErrorCallbackFn:c=>{console.log("Error: ",c.getError().data),g(v,!0)}};window.initializeAndOpenPlayer(s)}else g(v,!0)}var Ee=le(p('<script type="text/javascript" src="https://cdn.applixir.com/applixir.app.v6.0.1.js"><\/script><!>',1)),Se=()=>location.reload(),Pe=p("<p> </p>"),Re=(A,v)=>g(v,!0),Ce=p('<button class="svelte-1kw26tt">Continue without supporting us</button>'),De=p(`<div class="container svelte-1kw26tt"><div class="adblock-warning svelte-1kw26tt"><h2>Ad Blocker Detected</h2> <p>CCPorted relies on ads to keep the lights on. Please consider
                disabling your ad blocker for this site.</p> <p>Only 5% of users have disabled their ad blocker. Be part of the
                solution!</p> <button class="svelte-1kw26tt">I've disabled my ad blocker, reload the game</button> <!></div></div>`),Ae=p('<h2 class="svelte-1kw26tt"> </h2> <p class="svelte-1kw26tt"> </p> <img class="svelte-1kw26tt"/>',1),Te=p('<div class="play svelte-1kw26tt"><!> <button class="svelte-1kw26tt">Play Game</button></div> <div id="ad-container"></div>',1),Ne=p('<!> <iframe frameborder="0" allowfullscreen="" class="svelte-1kw26tt"></iframe>',1),Oe=p('<div class="container svelte-1kw26tt"><h2>Error</h2> <p> </p></div>'),Le=p('<div class="container svelte-1kw26tt"><h2>Loading...</h2></div>'),$e=p("<!> <!>",1);function ze(A,v){se(v,!0);let s=k(null),c=k(!1),h=k(null),R=k(15),Y=k(!1),B=k(!0);async function W(){console.log("[R][PLAY][fetchGameData] Fetching game data");const a=D.url.searchParams.get("gameID");if(!a){g(h,"Missing gameID query parameter");return}g(B,I.isAHost(),!0);const o={TableName:"games_list",Key:{gameID:{S:a}}},r=new be(o);if(u.dynamoDBClient||(console.log("[R][PLAY][fetchGameData] Need to wait for tooling"),await H()),!u.dynamoDBClient){g(h,"DynamoDB client not initialized");return}const n=await u.dynamoDBClient.send(r);if(!n.Item){g(h,"Game not found");return}const d=Ie(n.Item);g(s,d,!0),g(K,!1),g(c,await we(),!0),console.log("[R][PLAY][fetchGameData] Adblock detected:",e(c))}let K=k(!0),_=k(null),O=k(!1);ae(async()=>{if(await j(),await W(),e(h)||!e(s))return;const t=D.url.searchParams.get("r");if(!t||t!=="t")try{await _e(e(s).gameID)}catch(a){console.error("Failed to track click:",a)}else{const a=new URL(D.url);a.searchParams.delete("r"),window.history.replaceState({},document.title,a.toString())}if(e(c)){const a=setInterval(()=>{e(R)>0?g(R,e(R)-1):clearInterval(a)},1e3)}});function V(t){if(console.log("[R][PLAY][updateIframe] Updating to",t),t.name==I.currentServer.name||!e(_)||!e(s)||!ke)return;const a=t.address.split(",")[0],r=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(a)?"http":window.isSecureContext?"https":"http";e(_).src=`${r}://${a}/${t.path}${e(s).gameID}/index.html`;let i=D.url.searchParams;i.set("server",t.name);var n=new URL(D.url);n.search=i.toString(),window.history.pushState({},"",n)}ne(()=>{e(s)&&!e(h)&&(setTimeout(()=>{e(_)&&e(_).addEventListener("load",async t=>{if(!e(_))return;const a=e(_).contentWindow;if(a){if(u.awsReady||await H(),u.loggedIn&&u.user){console.log("[R][PLAY][updateIframe] Iframe loaded. User logged in: true");try{const o=u.user.tokens||{};a.postMessage({action:"SET_TOKENS",content:o})}catch(o){console.error("Error sending tokens:",o)}}else console.log("[R][PLAY][updateIframe] Iframe loaded. User not logged in.");e(_).focus()}})},0),window.addEventListener("message",async t=>{try{if(!t.data.fromInternal)return;if(!["http://localhost:5173",...I.servers.map(r=>`https://${r.hostname}`)].includes(t.origin)){console.warn(`[R][PLAY][updateIframe][message] Rejected message from unauthorized origin: ${t.origin}`);return}const o=t.data;if(o.action==="GET_TOKENS"){const r={requestId:o.requestId};if(u.loggedIn&&u.user){console.log("[R][PLAY][updateIframe][message-GET_TOKENS] User logged in, sending tokens");try{const i=u.user.tokens||{};r.action="SET_TOKENS",r.content=i}catch(i){console.error("Error getting user tokens:",i),r.action="ERROR",r.error="Failed to get user tokens"}}else if(await j(),u.loggedIn&&u.user)try{const i=u.user.tokens||{};r.action="SET_TOKENS",r.content=i}catch(i){console.error("Error getting user tokens:",i),r.action="ERROR",r.error="Failed to get user tokens"}else r.action="NO_USER";if(console.log("[R][PLAY][updateIframe][message-GET_TOKENS] Sending response:",r),!t.source)return;t.source.postMessage(r,{targetOrigin:t.origin})}else if(o.action==="SWITCH_SERVER")V(o.server);else if(o.action!=="CACHE_ENABLED"){if(!t.source)return;t.source.postMessage({action:"UNKNOWN_ACTION",requestId:o.requestId},{targetOrigin:t.origin})}}catch(a){if(!t.source)return;t.source.postMessage({action:"ERROR",error:a.message,requestId:t.data.requestId})}}))});var M=$e();re(t=>{var a=Ee();w(S(a)),C(()=>ce.title=`
        ${e(s)?`Playing ${e(s).fName}`:"Loading..."} | CCPorted
    `),f(t,a)});var U=S(M);{var X=t=>{var a=De(),o=b(a),r=w(b(o),6);r.__click=[Se];var i=w(r,2);{var n=l=>{var m=Pe(),E=b(m);y(m),C(()=>T(E,`You can continue in ${e(R)??""} seconds...`)),f(l,m)},d=l=>{var m=Ce();m.__click=[Re,Y],f(l,m)};P(i,l=>{e(R)>0?l(n):l(d,!1)})}y(o),y(a),f(t,a)};P(U,t=>{e(c)&&!e(Y)&&!e(B)&&e(O)&&t(X)})}var Z=w(U,2);{var J=t=>{var a=Ne(),o=S(a);{var r=n=>{var d=Te(),l=S(d),m=b(l);{var E=$=>{var q=Ae(),x=S(q),ee=b(x,!0);y(x);var G=w(x,2),te=b(G,!0);y(G);var F=w(G,2);C(()=>{T(ee,e(s).fName),T(te,e(s).description),N(F,"alt",`Cover art for ${e(s).fName}`),N(F,"src",`${I.currentServer.protocol}://${I.currentServer.hostname}${I.currentServer.path}${e(s).gameID}${e(s).thumbPath}`)}),f($,q)};P(m,$=>{e(s)&&$(E)})}var L=w(m,2);L.__click=[ye,O],y(l),de(2),f(n,d)};P(o,n=>{e(O)||n(r)})}var i=w(o,2);me(i,n=>g(_,n),()=>e(_)),C(()=>{N(i,"src",`${I.currentServer.protocol}://${I.currentServer.hostname}${I.currentServer.path}${e(s).gameID}/index.html`),N(i,"title",`Playing ${e(s).fName}`)}),f(t,a)},Q=t=>{var a=z(),o=S(a);{var r=n=>{var d=Oe(),l=w(b(d),2),m=b(l,!0);y(l),y(d),C(()=>T(m,e(h))),f(n,d)},i=n=>{var d=z(),l=S(d);{var m=E=>{var L=Le();f(E,L)};P(l,E=>{e(K)&&E(m)},!0)}f(n,d)};P(o,n=>{e(h)?n(r):n(i,!1)},!0)}f(t,a)};P(Z,t=>{e(s)?t(J):t(Q,!1)})}f(A,M),ie()}oe(["click"]);export{ze as component};
